package crawler_test

import (
	"testing"

	"github.com/capybara-alt/my-assemble/infrastructure/crawler"
	"github.com/capybara-alt/my-assemble/model"
	"github.com/stretchr/testify/assert"
)

func TestEnCoralWeaponCrawler(t *testing.T) {
	test := struct {
		name string
		want model.Want[model.CrawlResultJSON]
	}{
		name: "[正常系]エネルギー・コーラル武器ページのクロールテスト",
		want: model.Want[model.CrawlResultJSON]{
			Value: model.CrawlResultJSON{
				string(model.DEFAULT_WEAPON_ARM_UNIT_TYPE): {
					"レーザーライフル": {
						"VP-66LR": {
							"カテゴリー":     "LASER RIFLE",
							"メーカー":      "アーキバス",
							"価格":        "98,000",
							"攻撃力":       "256",
							"衝撃力":       "105",
							"衝撃残留":      "46",
							"攻撃時発熱":     "160",
							"チャージ攻撃力":   "1222",
							"チャージ衝撃力":   "500",
							"チャージ衝撃残留":  "180",
							"チャージ攻撃時発熱": "660",
							"直撃補正":      "140",
							"射撃反動":      "18",
							"性能保証射程":    "200",
							"有効射程":      "263",
							"連射性能":      "1.7",
							"チャージEN負荷":  "538",
							"チャージ時間":    "1.6",
							"チャージ消費弾数":  "3",
							"総弾数":       "280",
							"冷却性能":      "413",
							"弾単価":       "150",
							"重量":        "3560",
							"EN負荷":      "480",
						},
						"VE-66LRA": {
							"カテゴリー":     "LASER RIFLE",
							"メーカー":      "アーキバス先進開発局",
							"価格":        "180,000",
							"攻撃力":       "466",
							"衝撃力":       "194",
							"衝撃残留":      "81",
							"攻撃時発熱":     "180",
							"チャージ攻撃力":   "1677",
							"チャージ衝撃力":   "535",
							"チャージ衝撃残留":  "230",
							"チャージ攻撃時発熱": "730",
							"直撃補正":      "140",
							"射撃反動":      "30",
							"性能保証射程":    "220",
							"有効射程":      "382",
							"連射性能":      "1.1",
							"チャージEN負荷":  "628",
							"チャージ時間":    "2.8",
							"チャージ消費弾数":  "3",
							"総弾数":       "90",
							"冷却性能":      "335",
							"弾単価":       "250",
							"重量":        "4940",
							"EN負荷":      "532",
						},
						"VE-66LRB": {
							"カテゴリー":     "LASER RIFLE",
							"メーカー":      "アーキバス先進開発局",
							"価格":        "235,000",
							"攻撃力":       "778",
							"衝撃力":       "288",
							"衝撃残留":      "134",
							"攻撃時発熱":     "280",
							"チャージ攻撃力":   "2352",
							"チャージ衝撃力":   "690",
							"チャージ衝撃残留":  "330",
							"チャージ攻撃時発熱": "1000",
							"直撃補正":      "145",
							"射撃反動":      "20",
							"性能保証射程":    "206",
							"有効射程":      "324",
							"連射性能":      "0.7",
							"チャージEN負荷":  "737",
							"チャージ時間":    "2.3",
							"チャージ消費弾数":  "3",
							"総弾数":       "108",
							"冷却性能":      "246",
							"弾単価":       "400",
							"重量":        "7760",
							"EN負荷":      "604",
						},
					},
					"レーザーショットガン": {
						"WUERGER/66E": {
							"カテゴリー":     "LASER SHOTGUN",
							"メーカー":      "シュナイダー",
							"価格":        "147,000",
							"攻撃力":       "504",
							"衝撃力":       "405",
							"衝撃残留":      "144",
							"攻撃時発熱":     "180",
							"チャージ攻撃力":   "1459",
							"チャージ衝撃力":   "950",
							"チャージ衝撃残留":  "360",
							"チャージ攻撃時発熱": "1000",
							"直撃補正":      "145",
							"射撃反動":      "20",
							"性能保証射程":    "130",
							"有効射程":      "235",
							"連射性能":      "1.1",
							"チャージEN負荷":  "484",
							"チャージ時間":    "0.6",
							"チャージ消費弾数":  "3",
							"総弾数":       "66",
							"冷却性能":      "244",
							"弾単価":       "200",
							"重量":        "2880",
							"EN負荷":      "440",
						},
						"VP-66LS": {
							"カテゴリー":     "LASER SHOTGUN",
							"メーカー":      "アーキバス",
							"価格":        "105,000",
							"攻撃力":       "560",
							"衝撃力":       "304",
							"衝撃残留":      "88",
							"攻撃時発熱":     "190",
							"チャージ攻撃力":   "1307",
							"チャージ衝撃力":   "950",
							"チャージ衝撃残留":  "460",
							"チャージ爆発範囲":  "45",
							"チャージ攻撃時発熱": "650",
							"直撃補正":      "145",
							"射撃反動":      "20",
							"性能保証射程":    "130",
							"有効射程":      "259",
							"連射性能":      "0.8",
							"チャージEN負荷":  "582",
							"チャージ時間":    "0.9",
							"チャージ消費弾数":  "4",
							"総弾数":       "60",
							"冷却性能":      "203",
							"弾単価":       "300",
							"重量":        "3540",
							"EN負荷":      "510",
						},
					},
					"レーザーハンドガン": {
						"VP-66LH": {
							"カテゴリー":     "LASER HANDGUN",
							"メーカー":      "アーキバス",
							"価格":        "92,000",
							"攻撃力":       "175",
							"衝撃力":       "95",
							"衝撃残留":      "39",
							"攻撃時発熱":     "90",
							"チャージ攻撃力":   "175×6",
							"チャージ衝撃力":   "95×6",
							"チャージ衝撃残留":  "39×6",
							"チャージ攻撃時発熱": "90",
							"直撃補正":      "140",
							"射撃反動":      "17",
							"性能保証射程":    "190",
							"有効射程":      "247",
							"連射性能":      "2.5",
							"チャージEN負荷":  "435",
							"チャージ時間":    "1.2",
							"総弾数":       "380",
							"冷却性能":      "315",
							"弾単価":       "80",
							"重量":        "2800",
							"EN負荷":      "395",
						},
					},
					"プラズマライフル": {
						"Vvc-760PR": {
							"カテゴリー":     "PLASMA RIFLE",
							"メーカー":      "VCPL",
							"価格":        "202,000",
							"攻撃力":       "936",
							"衝撃力":       "384",
							"衝撃残留":      "248",
							"爆発範囲":      "30",
							"攻撃時発熱":     "300",
							"チャージ攻撃力":   "1368",
							"チャージ衝撃力":   "712",
							"チャージ衝撃残留":  "368",
							"チャージ爆発範囲":  "60",
							"チャージ攻撃時発熱": "1000",
							"直撃補正":      "125",
							"射撃反動":      "15",
							"有効射程":      "430",
							"連射性能":      "0.7",
							"チャージEN負荷":  "593",
							"チャージ時間":    "1.5",
							"チャージ消費弾数":  "3",
							"総弾数":       "90",
							"冷却性能":      "254",
							"弾単価":       "360",
							"重量":        "3330",
							"EN負荷":      "490",
						},
						"IA-C01W1: NEBULA": {
							"カテゴリー":     "PLASMA RIFLE",
							"メーカー":      "ルビコン調査技研",
							"価格":        "185,000",
							"レギュレーション":  "1.03",
							"攻撃力":       "528",
							"衝撃力":       "198",
							"衝撃残留":      "132",
							"爆発範囲":      "20",
							"攻撃時発熱":     "175",
							"チャージ攻撃力":   "1716 (-192)",
							"チャージ衝撃力":   "840 (-312)",
							"チャージ衝撃残留":  "432 (-180)",
							"チャージ爆発範囲":  "70",
							"チャージ攻撃時発熱": "625",
							"直撃補正":      "125",
							"射撃反動":      "15",
							"有効射程":      "460",
							"連射性能":      "1.5",
							"チャージEN負荷":  "737",
							"チャージ時間":    "2.7 (+1)",
							"チャージ消費弾数":  "3",
							"総弾数":       "58",
							"冷却性能":      "238",
							"弾単価":       "600",
							"重量":        "3890",
							"EN負荷":      "609",
						},
					},
					"コーラルライフル": {
						"IA-C01W6: NB-REDSHIFT": {
							"カテゴリー":     "CORAL RIFLE",
							"メーカー":      "ルビコン調査技研",
							"価格":        "312,000",
							"攻撃力":       "765",
							"衝撃力":       "188",
							"衝撃残留":      "188",
							"爆発範囲":      "24",
							"攻撃時発熱":     "280",
							"チャージ攻撃力":   "1718",
							"チャージ衝撃力":   "936",
							"チャージ衝撃残留":  "936",
							"チャージ爆発範囲":  "42",
							"チャージ攻撃時発熱": "450",
							"直撃補正":      "190",
							"PA干渉":      "122",
							"射撃反動":      "15",
							"有効射程":      "580",
							"連射性能":      "0.7",
							"チャージEN負荷":  "808",
							"チャージ時間":    "1.7",
							"チャージ消費弾数":  "2",
							"総弾数":       "52",
							"冷却性能":      "186",
							"弾単価":       "500",
							"重量":        "4040",
							"EN負荷":      "667",
						},
						"IB-C03W1: WLT 011": {
							"カテゴリー":       "CORAL RIFLE",
							"メーカー":        "ルビコン調査技研",
							"価格":          "335,000",
							"攻撃力":         "405",
							"衝撃力":         "152",
							"衝撃残留":        "152",
							"爆発範囲":        "7",
							"攻撃時発熱":       "200",
							"フルチャージ攻撃力":   "2835",
							"フルチャージ衝撃力":   "4050",
							"フルチャージ衝撃残留":  "4050",
							"フルチャージ攻撃時発熱": "1000",
							"直撃補正":        "190",
							"PA干渉":        "120",
							"射撃反動":        "15",
							"有効射程":        "940",
							"連射性能":        "1.1",
							"チャージEN負荷":    "1020",
							"フルチャージ時間":    "4.3",
							"フルチャージ消費弾数":  "12",
							"総弾数":         "180",
							"冷却性能":        "180",
							"弾単価":         "400",
							"重量":          "9030",
							"EN負荷":        "850",
						},
					},
					"マルチENライフル": {
						"44-142 KRSV": {
							"カテゴリー":       "MULTI ENERGY RIFLE",
							"メーカー":        "オールマインド",
							"価格":          "377,000",
							"攻撃力":         "312",
							"衝撃力":         "112",
							"衝撃残留":        "76",
							"爆発範囲":        "20",
							"攻撃時発熱":       "120",
							"フルチャージ攻撃力":   "2522",
							"フルチャージ衝撃力":   "1930",
							"フルチャージ衝撃残留":  "1033",
							"フルチャージ爆発範囲":  "30",
							"フルチャージ攻撃時発熱": "1000",
							"直撃補正":        "125",
							"射撃反動":        "40",
							"有効射程":        "620",
							"連射性能":        "3.4",
							"チャージEN負荷":    "955",
							"フルチャージ時間":    "4.5",
							"フルチャージ消費弾数":  "10",
							"総弾数":         "80",
							"冷却性能":        "167",
							"弾単価":         "600",
							"重量":          "10120",
							"EN負荷":        "707",
						},
					},
					"パルスガン": {
						"HI-16: GU-Q1": {
							"カテゴリー": "PULSE GUN",
							"メーカー":  "タキガワ・ハーモニクス",
							"価格":    "90,000",
							"攻撃力":   "36",
							"衝撃力":   "11",
							"衝撃残留":  "6",
							"攻撃時発熱": "35",
							"直撃補正":  "140",
							"PA干渉":  "527",
							"射撃反動":  "5",
							"有効射程":  "250",
							"連射性能":  "20.0",
							"総弾数":   "560",
							"冷却性能":  "623",
							"弾単価":   "30",
							"重量":    "2110",
							"EN負荷":  "368",
						},
						"HI-18: GU-A2": {
							"カテゴリー": "PULSE GUN",
							"メーカー":  "タキガワ・ハーモニクス",
							"価格":    "159,000",
							"攻撃力":   "68",
							"衝撃力":   "24",
							"衝撃残留":  "12",
							"攻撃時発熱": "55",
							"直撃補正":  "150",
							"PA干渉":  "537",
							"射撃反動":  "5",
							"有効射程":  "310",
							"連射性能":  "10.0",
							"総弾数":   "380",
							"冷却性能":  "295",
							"弾単価":   "60",
							"重量":    "2650",
							"EN負荷":  "446",
						},
					},
				},
			},
			ErrMsg: "",
		},
	}
	c := crawler.NewEnCoralWeapon()
	t.Run(test.name, func(t *testing.T) {
		results, err := c.Fetch()
		assert.Equal(t, err, nil)
		assert.Equal(t, test.want.Value, results)
	})
}
